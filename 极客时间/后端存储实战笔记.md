## 一些知识点

#### 如何避免重复下单

- 我们给订单系统增加一个生成订单号的服务，这个服务没有参数，返回值就是一个新的、全局唯一的订单号。
- 在用户进入创建订单的页面时，前端页面先调用这个生成订单号服务得到一个订单号，在用户提交订单的时候，在创建订单的请求中带着这个订单号。

#### ABA问题

- 更新订单状态天然具有幂等性，但是存在aba问题，aba问题的典型解决思路就是增加一个版本号。
- 每次查询的时候拿到版本号，更新的时候带上这个版本号，如果一致，更新成功，如果不一致更新失败。

#### 如何不停机更换数据库（mysql）

- 上线同步程序，从旧库中复制数据到新库中，并实时保持同步；
- 上线双写订单服务，只读写旧库；
- 开启双写，同时停止同步程序；
- 开启对比和补偿程序，确保新旧数据库数据完全一样；
- 逐步切量读请求到新库上；
- 下线对比补偿程序，关闭双写，读写都切换到新库上；
- 下线旧库和订单服务的双写功能。

#### 系统性能基线图

<img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ge09zsjex8j30u013hauf.jpg" style="zoom:50%;" />

